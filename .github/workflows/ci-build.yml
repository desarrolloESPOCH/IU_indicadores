name: "Flujo CI-Build"
run-name: "CI-Build para ${{ github.event_name }} de ${{ github.actor }} en ${{ github.ref }}"

on:
  pull_request:
    branches: ["main"]
    # types: [closed]

env:
  ANGULAR_CLI_VERSION: 19

jobs:
  linter:
    runs-on: self-hosted
    container: node:20

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: "Instalar dependencias"
        run: npm install

      - name: "Ejecutar linter"
        run: npm run lint

  build:
    needs: linter
    runs-on: self-hosted
    container: node:20

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: "Instalar CLI de Angular"
        run: npm install -g @angular/cli@${{ env.ANGULAR_CLI_VERSION }}

      - name: "Instalar dependencias"
        run: npm install

      - name: "Compilar Angular"
        run: ng build --configuration=production

      - name: "Crear carpeta destino si no existe"
        run: mkdir -p /home/desarrollo2/iu/IU_Indicadores/dist/

      - name: "Mover `dist` al destino final"
        run: mv dist/iu-indicadores /home/desarrollo2/iu/IU_Indicadores/dist/

      - name: "Verificar archivos en el destino"
        run: ls -l /home/desarrollo2/iu/IU_Indicadores/dist/

      # - name: Reiniciar Nginx despu√©s del despliegue
      #   run: sudo systemctl restart nginx
